<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/twbs-pagination.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="./search.css" />
    <title>Tâm Duck Go</title>
  </head>

  <body>
    <h1>Tâm Duck Go</h1>
    
    <input type="text" name="text" id="search-input" />

    <div class="btn" role="button">Search</div>

    <div class="result"></div>
    <div id="pagination"></div>

    <script>
      var page = 1;
      var totalPage = 0;
      $(function(){
        var api_url = 'http://localhost:3000/api/search/';
        var pageNumber = 1;
        var getResult = function() {
            var text = $("#search-input").val();
            console.log(text)
            if(text){
              fetchData(text)
              $('#pagination').twbsPagination({
                totalPages: 10,
                visiblePages: 6,
                next: 'Next',
                prev: 'Prev',
                onPageClick: function (event,page) {
                  fetchData(text,page)
                }
              })
            }
          }

        function fetchData(text,page) {
          $.ajax({
              url: api_url,
              type: "GET",
              data:{
                text,
                page: page ? page : pageNumber
              },
              success: function (response) {
                var result = response.response.docs;
                var numFound = response.response.numFound;
                console.log(result)
                console.log(numFound)
              },
              error: function(error) {
                console.log(error)
              }
            })
        }

        

        $(".btn").click(getResult);
        $(".search-input").keypress(function() {
          if (event.which == 13) getResult();
        });
      })
      </script>
  </body>
</html>
